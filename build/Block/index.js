(()=>{"use strict";const e=window.React,a=window.wp.blocks,t=window.wp.blockEditor,l=window.wp.components,s=window.wp.element,n=window.wp.i18n;(0,a.registerBlockType)("sushma/api-data",{attributes:{showId:{type:"boolean",default:!0},showFname:{type:"boolean",default:!0},showLname:{type:"boolean",default:!0},showEmail:{type:"boolean",default:!0},showDate:{type:"boolean",default:!0}},edit:function({attributes:a,setAttributes:o}){const{showId:i,showFname:r,showLname:m,showEmail:c,showDate:h}=a,[u,d]=(0,s.useState)(null),[w,p]=(0,s.useState)(!0),[b,E]=(0,s.useState)(null),y=(0,t.useBlockProps)();return(0,s.useEffect)(()=>{fetch("/wp-json/sushma-api/v1/data").then(e=>{if(!e.ok)throw new Error((0,n.__)("Failed to fetch data","sushma-api"));return e.json()}).then(e=>{if(!e.success||!e.data)throw new Error((0,n.__)("Invalid data format","sushma-api"));d(e.data),E(null)}).catch(e=>{console.error("API Error:",e),E(e.message)}).finally(()=>{p(!1)})},[]),(0,e.createElement)(e.Fragment,null,(0,e.createElement)(t.InspectorControls,null,(0,e.createElement)(l.PanelBody,{title:(0,n.__)("Column Visibility","sushma-api"),initialOpen:!0},(0,e.createElement)(l.ToggleControl,{label:(0,n.__)("Show ID","sushma-api"),checked:i,onChange:e=>o({showId:e})}),(0,e.createElement)(l.ToggleControl,{label:(0,n.__)("Show First Name","sushma-api"),checked:r,onChange:e=>o({showFname:e})}),(0,e.createElement)(l.ToggleControl,{label:(0,n.__)("Show Last Name","sushma-api"),checked:m,onChange:e=>o({showLname:e})}),(0,e.createElement)(l.ToggleControl,{label:(0,n.__)("Show Email","sushma-api"),checked:c,onChange:e=>o({showEmail:e})}),(0,e.createElement)(l.ToggleControl,{label:(0,n.__)("Show Date","sushma-api"),checked:h,onChange:e=>o({showDate:e})}))),(0,e.createElement)("div",{...y},(()=>{if(w)return(0,e.createElement)("div",{style:{textAlign:"center",padding:"40px"}},(0,e.createElement)(l.Spinner,null),(0,e.createElement)("p",null,(0,n.__)("Loading data...","sushma-api")));if(b)return(0,e.createElement)(l.Notice,{status:"error",isDismissible:!1},b);let t,s;if(u.data&&u.data.headers&&u.data.rows)t=u.data.headers,s=u.data.rows;else{if(!u.headers||!u.rows)return(0,e.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,n.__)("No data available","sushma-api"));t=u.headers,s=u.rows}if(!Array.isArray(s)){if("object"!=typeof s||null===s)return(0,e.createElement)(l.Notice,{status:"warning",isDismissible:!1},(0,n.__)("Invalid data format","sushma-api"));s=Object.values(s)}const o={showId:{key:"id",label:t[0]||"ID"},showFname:{key:"fname",label:t[1]||"First Name"},showLname:{key:"lname",label:t[2]||"Last Name"},showEmail:{key:"email",label:t[3]||"Email"},showDate:{key:"date",label:t[4]||"Date"}},i=Object.entries(o).filter(([e])=>a[e]);return 0===i.length?(0,e.createElement)(l.Notice,{status:"info",isDismissible:!1},(0,n.__)("Please select at least one column to display","sushma-api")):(0,e.createElement)("div",{className:"sushma-api-table-wrapper"},(0,e.createElement)("table",{className:"wp-list-table widefat fixed striped sushma-api-table"},(0,e.createElement)("thead",null,(0,e.createElement)("tr",null,i.map(([a,t])=>(0,e.createElement)("th",{key:t.key,className:`sushma-api-table-header sushma-api-table-${t.key}`},t.label)))),(0,e.createElement)("tbody",null,s.map((a,t)=>(0,e.createElement)("tr",{key:t},i.map(([t,l])=>(0,e.createElement)("td",{key:l.key,className:`sushma-api-table-${l.key}`},"date"===l.key&&a[l.key]?new Date(1e3*a[l.key]).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):a[l.key]||"")))))))})()))},save:function(){return null}})})();